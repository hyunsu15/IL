## 배치 왜써야함?

스케줄러에 jpaRepository 사용해도 되지않음?

작은 규모일때는 해도됨. 우리 과제에서도 해도 된다고도 보고있음.

- 대용량 조회시, 데이터가 한꺼번에 메모리에 로드하여 메모리 터짐.
- 재시작/복구 불가능
- 트랜잭션 문제
등등

많은 단점이 있음.


## 스프링 배치
스프링 배치의 공식문서를 확인해보면 알겠지만, 고가용성에 진심이다.
- 부분적으로 실패할 때 전체 롤백할건지, 무시하고 할건지
- 재시도는 몇번까지 할건지
- 특정 예외일때는 어떻게 할건지

등등 스프링 배치는 해당 옵션을 편하게 지원해준다.


## Job
Job-> JobInstance-> JobExecution 로 구성되어있음.
- Job은 할일
- JobInstance은 Job이 실행했어야하는 기록
- JobExecution는 실제 Job을 실행.
- Job은 여러 Step로 구성할수있다.
이때 다양하게 step을 설정할 수 있다.

## 최적화
일반적으로는 단일스레드, 단일 프로세스 job으로 충분히 해결될 수 있다.
그러니 단일스레드,단일 프로세스로 해보고, 안될때, 복잡한 아키택처로 넘어가기.


## 알아두면 좋은사항들

### @EnableBatchProcessing나  DefaultBatchConfiguration 둘중하나 사용

### itemProccessor는 멱등성있게 작성하기.
 재시도나 스킵할수있기에 멱등성을 보장해야한다. 안되는 거는 곤란할 수 있음.

### BatchAutoConfiguration으로 기본 설정 추가됨

### JOB은 멱등성있게 실행됨.

만약 실패하면, 그 실패한 부분도 실행함.

만약 파라미터가 같고, 이미 성공했다면 실행되지 않음.

JobParameters가 다르면, 다른 잡으로 실행되서, 동작함.
- 만약 실패했고 같은 배치라면 전에 했었던 JobParamters를 넣어야 함.
- 만약 성공해도 계속 배치를 실행해야한 경우는 이제

### Order by는 고려해라

실패시 읽은 레코드 만큼 건너뛰고 다음 레코드부터 읽기를 재개하기에 순서가 일정한 order by 유일값으로 정렬하는 것이 좋아보임.



